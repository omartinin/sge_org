# PR0603

## 1. Personalización del módulo

- Creamos los modelos:

    `models.py`
    ```
    # -*- coding: utf-8 -*-

    from odoo import models, fields, api
    from odoo.exceptions import ValidationError


    class stock_product(models.Model):
        _name = 'stock_management.stock_product'
        _description = 'stock_management.stock_product'
        _sql_constraints = [('unique_name','unique(name)','El nombre del producto ha de ser único.'),
                            ('check_stock', 'check(quantity >= 0)','El stock ha de ser mayor o igual que 0.')
                            ]

        name = fields.Char( string = 'Nombre', required = True)
        category = fields.Selection(
            string='Categoría',
            selection=[('jardin', 'Jardín'),
                        ('hogar', 'Hogar'),
                        ('electrodomesticos', 'Electrodomésticos')]
        )
        currency_id = fields.Many2one('res.currency', string='Currency', default=lambda self: self.env.ref('base.EUR'))
        price = fields.Monetary(string = 'Precio', currency_field='currency_id')
        quantity = fields.Integer(string = 'Cantidad')
        total_value = fields.Monetary(string='Total',
            currency_field='currency_id',
            compute="_compute_total_value",
            store=True
        )
        minimum_quantity = fields.Integer( string = 'Stock mínimo')
        stock_status = fields.Selection( string = 'Estado del stock',
            selection=[('normal','Normal'),
                        ('low_stock','Low Stock')],
            compute= "_compute_stock_status",
            store=True
        )
        full_name = fields.Text(string = 'Nombre completo',
            compute= "_compute_full_name"
        )

        @api.depends('price','quantity')
        def _compute_total_value(self):
            for product in self:
                product.total_value = product.price * product.quantity

        @api.depends('minimum_quantity','quantity')
        def _compute_stock_status(self):
            for product in self:
                product.stock_status = 'normal' if product.quantity > product.minimum_quantity else 'low_stock'

        @api.depends('name','category')
        def _compute_full_name(self):
            for product in self:
                name = product.name or ''
                categoria = dict(product._fields['category'].selection).get(product.category, '')
                product.full_name = name + " " + categoria

        @api.constrains('price')
        def _check_price(self):
            for producto in self:
                if producto.price < 0:
                    raise ValidationError('El precio debe ser mayor que 0.')

        @api.constrains('quantity')
        def _check_stock(self):
            for producto in self:
                if producto.quantity < 0:
                    raise ValidationError('El stock debe ser mayor que 0.')

        @api.constrains('total_value')
        def _check_total(self):
            for producto in self:
                if producto.total_value > 100000:
                    raise ValidationError('El valor total del stock no puede ser superior a 100000')

        @api.constrains('category')
        def _check_category(self):
            for producto in self:
                if not producto.category:
                    raise ValidationError('Ha de asignar una categoría')
    ```


- Creamos las views:
  
    `views.xml`
    ```
    <odoo>
        <data>
            <!-- explicit list view definition -->

            <record model="ir.ui.view" id="stock_management.list">
            <field name="name">stock_management list</field>
            <field name="model">stock_management.stock_product</field>
            <field name="arch" type="xml">
                <tree>
                <field name="name"/>
                <field name="category"/>
                <field name="price"/>
                <field name="quantity"/>
                <field name="total_value"/>
                <field name="minimum_quantity"/>
                <field name="stock_status"/>
                <field name="full_name"/>
                </tree>
            </field>
            </record>


            <!-- actions opening views on models -->

            <record model="ir.actions.act_window" id="stock_management.action_window">
            <field name="name">stock_management window</field>
            <field name="res_model">stock_management.stock_product</field>
            <field name="view_mode">tree,form</field>
            </record>


            <!-- Top menu item -->

            <menuitem name="stock_management" id="stock_management.menu_root"/>

            <!-- menu categories -->

            <menuitem name="Stock" id="stock_management.menu_1" parent="stock_management.menu_root"/>
            

            <!-- actions -->

            <menuitem name="Stock" id="stock_management.menu_1_list" parent="stock_management.menu_1"
                    action="stock_management.action_window"/>

        </data>
    </odoo>
    ```

- Definimos los permisos de acceso a modelos:
  
    `ir.model.access.csv`
    ```
    id,name,model_id:id,group_id:id,perm_read,perm_write,perm_create,perm_unlink
    access_stock_management_stock_management,stock_management_stock_product,model_stock_management_stock_product,base.group_user,1,1,1,1
    ```

## 2. Capturas

- [Cantidad negativa](./capturas/cantidadNegativa.png)
- [Categoría vacia](./capturas/CategoriaVacia.png)
- [Nombre Vacio](./capturas/nombreVacio.png)
- [Precio total elevado](./capturas/PrecioTotalElevado.png)
- [Todo correcto](./capturas/TodoCorrecto.png)